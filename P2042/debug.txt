这道题写了整整两天，总算ac了。。
主要就是被各种细节给恶心死。。
比如子段的长度大于等于1。。
翻转的时候，最长前缀和最长后缀也要交换。。
还有内存池。。。
不过splay最棒了！
